# 统一认证系统集成接口文档

## 一、概述

### 1. 用途

本文档定义了一组 API 接口，其他系统（如财务系统、教务系统）可通过调用接口向统一身份认证系统进行集成。

### 2. 适用版本

本文档定义的接口规范，对全版本统一身份认证系统有效。

### 3. 通信协议



* **角色定义**：


  * 统一身份认证服务为通信的服务器端（简称 “认证服务器”）；

  * 调用统一身份认证服务接口的其他系统是第三方应用服务（简称 “第三方应用”）；

  * 使用统一身份认证服务的使用者是师生用户（简称 “用户”）。

* **通信方式**：第三方应用和认证服务器通过 HTTP/HTTPS 协议通信，第三方应用使用 HTTP Get/Post 向认证服务器发送请求，认证服务器返回操作结果或用户信息给第三方应用。

### 4. 调用方式



* **URL 结构**：接口的请求地址为 URL，包含接口位置和请求参数，格式示例：`https://sso.edu.cn/serviceValidate?service=abc&ticket=st-123`。


  * 接口位置：`https://sso.edu.cn/serviceValidate`（本文档中所有 “[https://sso.edu.cn](https://sso.edu.cn)” 需替换成实际应用地址，如 “[http://auth.bupt.edu.cn/authserver/......](http://auth.bupt.edu.cn/authserver/......)”）；

  * 参数规则：参数以`name=value`形式拼接在 “?” 后。

* **URL 编码**：当 URL 请求参数值中包含 URL 地址保留字符（“;/?:@&=+\$,”）时，需按 “RFC2396: Uniform Resource Identifiers (URI):Generic Syntax” 规范将保留字符替换成`%hexhex`形式，同时可参考 HTTP 1.1 规范。

## 二、页面跳转集成接口

页面跳转登录方式为推荐方式，同等条件下建议使用该方式进行集成，且兼容 CAS 2.0、CAS 3.0 协议标准。

### 1. 登录流程

#### （1）首次登录流程



1. 用户通过浏览器打开第三方应用，第三方应用验证用户登录状态（如通过 session cookie 判断），判断用户未登陆后，将用户重定向到认证服务器；

2. 认证服务器验证用户登录状态，判断用户未登录后，向用户展示登录页面；

3. 用户完成登录操作；

4. 认证服务器设置用户浏览器 cookie 的 CASTGC 内容，并重定向用户到第三方应用；

5. 第三方应用从用户请求中获取 ticket，并使用 ticket 调用认证服务器验证接口，获取用户信息；

6. 第三方应用使用获取到的信息（如学工号、姓名）完成系统内登陆逻辑（如设置 session）。

#### （2）登录后第二次访问同一个第三方应用流程



1. 用户通过浏览器打开第三方应用，第三方应用验证用户登录状态（如通过 session cookie 判断）；

2. 第三方应用判断用户已登陆，向用户展示内容页面。

#### （3）登录后首次访问第二个第三方应用流程



1. 用户通过浏览器打开第三方应用，第三方应用验证用户登录状态（如通过 session cookie 判断），判断用户未登陆后，将用户重定向到认证服务器；

2. 认证服务器通过 CASTGC 验证用户登录状态，判断内容有效后，重定向用户到第三方应用；

3. 第三方应用从用户请求中获取 ticket，并使用 ticket 调用认证服务器验证接口，获取用户信息；

4. 第三方应用使用获取到的信息（如学工号、姓名）完成系统内登陆逻辑（如设置 session）。

### 2. 核心接口详情

#### （1）登录接口 `/login`



| 项目   | 内容                                                                                                                                            |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------- |
| 地址   | `https://sso.edu.cn/login`                                                                                                                    |
| 调用方式 | GET                                                                                                                                           |
| 参数   | `service`（必填）：URL 编码的第三方应用接口地址，用户完成登录后会重定向到该地址（需在服务管理白名单内），且该接口需完成：①从请求中获取 ticket 参数；②使用 ticket 调用票据验证接口`/serviceValidate`获取用户信息（ticket 一次生效） |
| 调用场景 | 第三方应用在判断用户未登录后，将用户重定向到该地址                                                                                                                     |
| 示例   | 请求：`https://sso.edu.cn/login?service=http%3a%2f%2fcaiwu.edu.cn`；用户完成登录后重定向到：`http://caiwu.edu.cn/sso?ticket=ST-123456`                        |

#### （2）登出接口 `/logout`



| 项目   | 内容                                                                        |
| ---- | ------------------------------------------------------------------------- |
| 地址   | `https://sso.edu.cn/logout`                                               |
| 调用方式 | GET                                                                       |
| 调用场景 | 用户在第三方应用点击注销 / 登出按钮后，第三方应用需：①调用后台接口，使用户 session 失效；②重定向用户到该地址，使统一认证登录状态失效 |
| 示例   | `https://sso.edu.cn/logout`                                               |

#### （3）票据验证接口



| 项目   | 内容                                                                                                                                       |
| ---- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| 地址   | CAS 2.0 协议：`https://sso.edu.cn/serviceValidate`；CAS 3.0 协议：`https://sso.edu.cn/p3/serviceValidate`                                       |
| 调用方式 | GET                                                                                                                                      |
| 参数   | ①`service`（必填）：同登录接口`/login`的`service`参数；②`ticket`（必填）：第三方应用获取到的 ticket（如 ST-123456）                                                     |
| 返回值  | XML 格式编码的调用结果，若 ticket 验证通过则返回用户信息，否则返回错误信息                                                                                              |
| 调用场景 | 第三方应用获取到 ticket 后，调用该接口获取用户信息                                                                                                            |
| 错误码  | ①`INVALID_REQUEST`：请求参数错误；②`INVALID_TICKET`：ticket 验证失败；③`INVALID_SERVICE`：ticket 验证成功但 service 不在白名单中；④`INTERNAL_ERROR`：认证服务内部错误        |
| 示例   | 请求：`https://sso.edu.cn/serviceValidate?service=http%3a%2f%2fcaiwu.edu.cn&ticket=ST-123456`；验证成功返回含用户信息的 XML，验证失败返回含`INVALID_TICKET`的 XML |

## 三、RESTful 集成接口

RESTful 接口用于无法使用页面跳转登录的场景。

### 1. 登录流程

#### （1）首次登录流程



1. 用户在第三方应用输入用户名、密码；

2. 第三方应用使用用户名、密码调用登录接口获取 TGT（TGT 长期有效，第三方应用可缓存该内容以实现后续免密码登录）；

3. 第三方应用使用 TGT 调用票据接口，获取 ticket；

4. 第三方应用使用 ticket 调用认证服务器验证接口，获取用户信息，完成登录。

#### （2）再次登录流程



1. 用户打开第三方应用，应用取出缓存的 TGT；

2. 第三方应用使用 TGT 调用票据接口，获取 ticket；

3. 第三方应用使用 ticket 调用认证服务器票据验证接口，获取用户信息，完成登录。

### 2. 核心接口详情

#### （1）登录接口 `/v1/tickets`（获取 TGT）



| 项目   | 内容                                                                                                                                                                                                                |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 地址   | `https://sso.edu.cn/v1/tickets`                                                                                                                                                                                   |
| 调用方式 | POST；请求头需设置为`'Content-type': 'Application/x-www-form-urlencoded'`                                                                                                                                                 |
| 参数   | ①`username`（必填）：用户的用户名；②`password`（必填）：用户的明文密码                                                                                                                                                                    |
| 返回值  | XML 格式编码的调用结果，若用户名、密码验证通过则返回 TGT，否则返回错误信息                                                                                                                                                                         |
| 调用场景 | 第三方应用使用用户输入的用户名、密码调用该接口获取 TGT                                                                                                                                                                                     |
| 特殊限制 | 调用该接口的 IP 需要在服务的 IP 白名单中，否则无法调用                                                                                                                                                                                   |
| 示例   | 请求：`POST https://sso.edu.cn/v1/tickets HTTP/1.0 'Content-type': 'Application/x-www-form-urlencoded' username=12345&password=password`；验证成功返回：`201 Created Location: http://www.whatever.com/cas/v1/tickets/{TGT}` |

#### （2）票据接口 `/v1/tickets/{TGT}`（获取 ticket）



| 项目   | 内容                                                                                                                                                                          |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 地址   | `https://sso.edu.cn/v1/tickets/{TGT}`（`{TGT}`为已获取的 TGT 值）                                                                                                                   |
| 调用方式 | POST；请求头需设置为`'Content-type': 'Application/x-www-form-urlencoded'`                                                                                                           |
| 参数   | `service`（必填）：URL 编码的第三方应用接口地址（需在服务管理白名单内）                                                                                                                                  |
| 返回值  | XML 格式编码的调用结果，若 TGT、service 验证通过则返回 ticket，否则返回错误信息                                                                                                                         |
| 调用场景 | 第三方应用使用 TGT 调用该接口获取 ticket                                                                                                                                                  |
| 示例   | 请求：`POST https://sso.edu.cn/v1/tickets/TGT-123456 HTTP/1.0 'Content-type': 'Application/x-www-form-urlencoded' service=http%3a%2f%2fcaiwu.edu.cn`；验证成功返回：`200 OK ST-123456` |

#### （3）票据验证接口

与 “页面跳转集成接口” 中的票据验证接口相同（即`/serviceValidate`或`/p3/serviceValidate`）。

## 四、附件

### 1. 附件 1：页面跳转登录 Tomcat 项目示例

#### （1）导入依赖文件（以 Maven 的 pom.xml 为例）



```
\<dependency>&#x20;

&#x20;   \<groupId>javax.servlet\</groupId>&#x20;

&#x20;   \<artifactId>servlet-api\</artifactId>&#x20;

&#x20;   \<version>2.5\</version>&#x20;

\</dependency>&#x20;

\<dependency>&#x20;

&#x20;   \<groupId>org.jasig.cas.client\</groupId>&#x20;

&#x20;   \<artifactId>cas-client-core\</artifactId>&#x20;

&#x20;   \<version>3.4.1\</version>&#x20;

\</dependency>
```

#### （2）web.xml filter 配置



```
\<?xml version="1.0" encoding="UTF-8"?>&#x20;

\<web-app xmlns="http://java.sun.com/xml/ns/javaee"&#x20;

&#x20;        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&#x20;

&#x20;        xsi:schemaLocation="http://java.sun.com/xml/ns/javaee&#x20;

&#x20;        http://java.sun.com/xml/ns/javaee/web-app\_4\_0.xsd"&#x20;

&#x20;        version="4.0">&#x20;

&#x20;   \<filter>&#x20;

&#x20;       \<filter-name>CASFilter\</filter-name>&#x20;

&#x20;       \<filter-class>org.jasig.cas.client.authentication.AuthenticationFilter\</filter-class>&#x20;

&#x20;       \<init-param>&#x20;

&#x20;           \<param-name>casServerLoginUrl\</param-name>&#x20;

&#x20;           \<!-- 这是认证服务端登录地址，需要根据学校现状做调整-->&#x20;

&#x20;           \<param-value> https://sso.edu.cn/login\</param-value>&#x20;

&#x20;       \</init-param>&#x20;

&#x20;       \<init-param>&#x20;

&#x20;           \<param-name>serverName\</param-name>&#x20;

&#x20;           \<!-- 这是第三方应用地址，即当前系统的访问地址，需要修改为你的系统-->&#x20;

&#x20;           \<param-value>http://caiwu.edu.cn\</param-value>&#x20;

&#x20;       \</init-param>&#x20;

&#x20;   \</filter>&#x20;

&#x20;   \<filter-mapping>&#x20;

&#x20;       \<filter-name>CASFilter\</filter-name>&#x20;

&#x20;       \<url-pattern>/protectedUrls/\*\</url-pattern>&#x20;

&#x20;   \</filter-mapping>&#x20;

&#x20;   \<!-- 该过滤器负责对Ticket 的校验工作，必须启用 -->&#x20;

&#x20;   \<filter>&#x20;

&#x20;       \<filter-name>CAS Validation Filter\</filter-name>

&#x20;       \<filter-class>org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter\</filter-class>&#x20;

&#x20;       \<init-param>&#x20;

&#x20;           \<param-name>casServerUrlPrefix\</param-name>&#x20;

&#x20;           \<!-- 这是认证服务端地址前缀，需要根据学校现状做调整-->&#x20;

&#x20;           \<param-value> https://sso.edu.cn\</param-value>&#x20;

&#x20;       \</init-param>&#x20;

&#x20;       \<init-param>&#x20;

&#x20;           \<param-name>serverName\</param-name>&#x20;

&#x20;           \<!-- 这是第三方应用地址，即当前系统的访问地址，需要修改为你的系统-->&#x20;

&#x20;           \<param-value> http://caiwu.edu.cn\</param-value>&#x20;

&#x20;       \</init-param>&#x20;

&#x20;   \</filter>&#x20;

&#x20;   \<filter-mapping>&#x20;

&#x20;       \<filter-name>CAS Validation Filter\</filter-name>&#x20;

&#x20;       \<url-pattern>/protectedUrls/\*\</url-pattern>&#x20;

&#x20;   \</filter-mapping>&#x20;

&#x20;   \<!-- 该过滤器负责实现HttpServletRequest 请求的包裹，比如允许开发者通过HttpServletRequest 的getUserPrincipal()方法获得SSO 登录用户的信息 -->&#x20;

&#x20;   \<filter>&#x20;

&#x20;       \<filter-name>CAS HttpServletRequest Wrapper Filter\</filter-name>&#x20;

&#x20;       \<filter-class>org.jasig.cas.client.util.HttpServletRequestWrapperFilter\</filter-class>&#x20;

&#x20;   \</filter>&#x20;

&#x20;   \<filter-mapping>&#x20;

&#x20;       \<filter-name>CAS HttpServletRequest Wrapper Filter\</filter-name>&#x20;

&#x20;       \<url-pattern>/protectedUrls/\*\</url-pattern>&#x20;

&#x20;   \</filter-mapping>&#x20;

&#x20;   \<!-- 示例1:通过filter 根据单点登录的结果设置本系统的登录状态信息，若不通过filter 进行登录，可注释掉以下内容 -->&#x20;

&#x20;   \<filter>&#x20;

&#x20;       \<display-name>DemoFilter\</display-name>&#x20;

&#x20;       \<filter-name>DemoFilter\</filter-name>&#x20;

&#x20;       \<filter-class>cn.edu.sso.demo.filter.DemoFilter\</filter-class>&#x20;

&#x20;   \</filter>&#x20;

&#x20;   \<filter-mapping>&#x20;

&#x20;       \<filter-name>DemoFilter\</filter-name>&#x20;

&#x20;       \<url-pattern>/protectedUrls/filter\_login.jsp\</url-pattern>

&#x20;       \<!--\<url-pattern>/protectedUrls/\*\</url-pattern>-->&#x20;

&#x20;   \</filter-mapping>&#x20;

\</web-app>
```

#### （3）通过 filter 完成登录（DemoFilter.java）



```
package cn.edu.sso.demo.filter;&#x20;

import org.jasig.cas.client.authentication.AttributePrincipal;&#x20;

import javax.servlet.\*;&#x20;

import javax.servlet.http.HttpServletRequest;&#x20;

import javax.servlet.http.HttpSession;&#x20;

import java.io.IOException;&#x20;

import java.util.Map;&#x20;

public class DemoFilter implements Filter {&#x20;

&#x20;   @Override&#x20;

&#x20;   public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse,&#x20;

&#x20;                        FilterChain filterChain) throws IOException, ServletException {&#x20;

&#x20;       // 获取用户拓展属性&#x20;

&#x20;       AttributePrincipal principal = (AttributePrincipal) ((HttpServletRequest)servletRequest).getUserPrincipal();&#x20;

&#x20;       Map attributes = principal.getAttributes();&#x20;

&#x20;       HttpSession session = ((HttpServletRequest) servletRequest).getSession();&#x20;

&#x20;       if (session.getAttribute("user") == null) {&#x20;

&#x20;           // 完成登录行为&#x20;

&#x20;           session.setAttribute("user", attributes);&#x20;

&#x20;           System.out.println("login in success from filter");&#x20;

&#x20;       }

&#x20;       filterChain.doFilter(servletRequest, servletResponse);&#x20;

&#x20;   }

&#x20;   @Override&#x20;

&#x20;   public void init(FilterConfig filterConfig) throws ServletException {}

&#x20;   @Override&#x20;

&#x20;   public void destroy() {}&#x20;

}
```

#### （4）通过 jsp 完成登录



```
<%@ page import="org.jasig.cas.client.authentication.AttributePrincipal" %>&#x20;

<%@ page import="java.util.Map" %>&#x20;

<% String basePath = request.getScheme() + "://" + request.getServerName() + ":" +&#x20;

request.getServerPort() + request.getContextPath(); %>&#x20;

<% AttributePrincipal principal = (AttributePrincipal)request.getUserPrincipal(); %>&#x20;

<% Map attributes = principal.getAttributes(); %>&#x20;

<%-- 完成登录 --%>&#x20;

<% if (session.getAttribute("user") == null) { session.setAttribute("user", attributes); } %>&#x20;

<% System.out.println("login in success from page"); %>&#x20;

<%@ page contentType="text/html;charset=UTF-8" language="java" %>&#x20;

<%@ page trimDirectiveWhitespaces="true" %>&#x20;

\<html>&#x20;

\<head>&#x20;

&#x20;   \<title>SSO JSP Login\</title>&#x20;

\</head>&#x20;

\<body>&#x20;

&#x20;   \<h1>遍历所有开放的属性:\</h1>&#x20;

&#x20;   \<table border="1">&#x20;

&#x20;       <% for (Object key : attributes.keySet()) { %>&#x20;

&#x20;       \<tr>&#x20;

&#x20;           \<td><%=key%>\</td>\<td><%=attributes.get(key)%>\</td>&#x20;

&#x20;       \</tr>&#x20;

&#x20;       <% } %>&#x20;

&#x20;   \</table>&#x20;

&#x20;   \<h1>注销:\</h1>&#x20;

&#x20;   \<button onclick="logout()">登出\</button>&#x20;

\</body>&#x20;

\<script>&#x20;

function logout() {&#x20;

&#x20;   // 使本系统登录状态失效&#x20;

&#x20;   var httpRequest = new XMLHttpRequest();&#x20;

&#x20;   // 先调用本系统注销接口&#x20;

&#x20;   httpRequest.open("GET", "<%=basePath%>/logout.jsp");&#x20;

&#x20;   httpRequest.send();&#x20;

&#x20;   httpRequest.onreadystatechange = function (ev) {&#x20;

&#x20;       if (httpRequest.readyState === 4 && httpRequest.status === 200) {

&#x20;           console.log(httpRequest.responseText);&#x20;

&#x20;           if (httpRequest.responseText === "success") {&#x20;

&#x20;               // 本系统注销成功后，调用sso 的注销&#x20;

&#x20;               window.open("https://sso.edu.cn/logout", "\_self");&#x20;

&#x20;           }

&#x20;       }

&#x20;   };

}

\</script>&#x20;

\</html>
```

### 2. 附件 2：RESTful 登录 Java 示例（TstRestfulAPI.java）



```
package restfulAPI;&#x20;

import java.io.IOException;&#x20;

import java.net.URLEncoder;&#x20;

import java.util.regex.Matcher;&#x20;

import java.util.regex.Pattern;&#x20;

import org.apache.commons.httpclient.HttpClient;&#x20;

import org.apache.commons.httpclient.methods.GetMethod;&#x20;

import org.apache.commons.httpclient.methods.PostMethod;&#x20;

import org.apache.commons.httpclient.NameValuePair;&#x20;

public class TstRestfulAPI {&#x20;

&#x20;   public static String getTicket(final String server, final String username, final String&#x20;

&#x20;           password, final String service) {&#x20;

&#x20;       notNull(server, "server must not be null");&#x20;

&#x20;       notNull(username, "username must not be null");&#x20;

&#x20;       notNull(password, "password must not be null");&#x20;

&#x20;       notNull(service, "service must not be null");&#x20;

&#x20;       return getServiceTicket(server, getTicketGrantingTicket(server, username, password),&#x20;

&#x20;               service);&#x20;

&#x20;   }&#x20;

&#x20;   /\*\*

&#x20;    \* 取得ST

&#x20;    \* @param server

&#x20;    \* @param ticketGrantingTicket

&#x20;    \* @param service

&#x20;    \*/

&#x20;   private static String getServiceTicket(final String server, final String ticketGrantingTicket,&#x20;

&#x20;                                         final String service) {&#x20;

&#x20;       if (ticketGrantingTicket == null)&#x20;

&#x20;           return null;&#x20;

&#x20;       final HttpClient client = new HttpClient();&#x20;

&#x20;       final PostMethod post = new PostMethod(server + "/" + ticketGrantingTicket);&#x20;

&#x20;       post.setRequestBody(new NameValuePair\[] { new NameValuePair("service", service) });&#x20;

&#x20;       try {&#x20;

&#x20;           client.executeMethod(post);&#x20;

&#x20;           final String response = post.getResponseBodyAsString();&#x20;

&#x20;           switch (post.getStatusCode()) {&#x20;

&#x20;               case 200:&#x20;

&#x20;                   return response;&#x20;

&#x20;               default:&#x20;

&#x20;                   warning("Invalid response code (" + post.getStatusCode() + ") from CAS " +

&#x20;                           "server!");&#x20;

&#x20;                   info("Response (1k): " + response.substring(0, Math.min(1024,&#x20;

&#x20;                           response.length())));&#x20;

&#x20;                   break;&#x20;

&#x20;           }&#x20;

&#x20;       } catch (final IOException e) {&#x20;

&#x20;           warning(e.getMessage());&#x20;

&#x20;       } finally {&#x20;

&#x20;           post.releaseConnection();&#x20;

&#x20;       }

&#x20;       return null;&#x20;

&#x20;   }

&#x20;   /\*\*

&#x20;    \* @param server

&#x20;    \* @param username

&#x20;    \* @param password

&#x20;    \*/

&#x20;   private static String getTicketGrantingTicket(final String server, final String username, final&#x20;

&#x20;           String password) {&#x20;

&#x20;       final HttpClient client = new HttpClient();&#x20;

&#x20;       final PostMethod post = new PostMethod(server);&#x20;

&#x20;       post.setRequestBody(new NameValuePair\[] { new NameValuePair("username", username),&#x20;

&#x20;               new NameValuePair("password", password) });&#x20;

&#x20;       try {&#x20;

&#x20;           client.executeMethod(post);&#x20;

&#x20;           final String response = post.getResponseBodyAsString();&#x20;

&#x20;           info("TGT="+response);&#x20;

&#x20;           switch (post.getStatusCode()) {&#x20;

&#x20;               case 201: {&#x20;

&#x20;                   final Matcher matcher =&#x20;

&#x20;                           Pattern.compile(".\*action=\\".\*/(.\*?)\\".\*").matcher(response);&#x20;

&#x20;                   if (matcher.matches())&#x20;

&#x20;                       return matcher.group(1);&#x20;

&#x20;                   warning("Successful ticket granting request, but no ticket found!");&#x20;

&#x20;                   info("Response (1k): " + response.substring(0, Math.min(1024,&#x20;

&#x20;                           response.length())));&#x20;

&#x20;                   break;&#x20;

&#x20;               }&#x20;

&#x20;               default:&#x20;

&#x20;                   warning("Invalid response code (" + post.getStatusCode() + ") from CAS " +

&#x20;                           "server!");&#x20;

&#x20;                   info("Response (1k): " + response.substring(0, Math.min(1024,&#x20;

&#x20;                           response.length())));&#x20;

&#x20;                   break;&#x20;

&#x20;           }&#x20;

&#x20;       } catch (final IOException e) {&#x20;

&#x20;           warning(e.getMessage());&#x20;

&#x20;       } finally {&#x20;

&#x20;           post.releaseConnection();&#x20;

&#x20;       }

&#x20;       return null;&#x20;

&#x20;   }&#x20;

&#x20;   private static void ticketValidate(String serverValidate, String serviceTicket, String&#x20;

&#x20;           service) {&#x20;

&#x20;       notNull(serviceTicket, "paramter 'serviceTicket' is not null");&#x20;

&#x20;       notNull(service, "paramter 'service' is not null");&#x20;

&#x20;       final HttpClient client = new HttpClient();&#x20;

&#x20;       GetMethod get = null;&#x20;

&#x20;       try {&#x20;

&#x20;           get = new GetMethod(serverValidate+"?"+"ticket="+serviceTicket+"\&service="+URLEncoder.encode(service, "UTF-8"));&#x20;

&#x20;           client.executeMethod(get);&#x20;

&#x20;           final String response = get.getResponseBodyAsString();&#x20;

&#x20;           info(response);&#x20;

&#x20;           switch (get.getStatusCode()) {&#x20;

&#x20;               case 200: {&#x20;

&#x20;                   info("成功取得用户数据");&#x20;

&#x20;               }&#x20;

&#x20;               default: {&#x20;

&#x20;               }&#x20;

&#x20;           }&#x20;

&#x20;       } catch (Exception e) {&#x20;

&#x20;           warning(e.getMessage());&#x20;

&#x20;       } finally {&#x20;

&#x20;           //释放资源&#x20;

&#x20;           if (get != null) get.releaseConnection();&#x20;

&#x20;       }&#x20;

&#x20;   }&#x20;

&#x20;   private static void notNull(final Object object, final String message) {&#x20;

&#x20;       if (object == null)&#x20;

&#x20;           throw new IllegalArgumentException(message);&#x20;

&#x20;   }&#x20;

&#x20;   public static void main(final String\[] args) throws Exception {&#x20;

&#x20;       //server 不可修改&#x20;

&#x20;       final String server = "https://sso.edu.cn/v1/tickets";

&#x20;       //用户名&#x20;

&#x20;       final String username = "username";&#x20;

&#x20;       //密码&#x20;

&#x20;       final String password = "password";&#x20;

&#x20;       //此地址要在服务管理的白名单内&#x20;

&#x20;       final String service = "http://caiwu.edu.cn/";&#x20;

&#x20;       //serviceValidate 接口地址&#x20;

&#x20;       final String proxyValidate = "https://sso.edu.cn/serviceValidate";&#x20;

&#x20;       ticketValidate(proxyValidate, getTicket(server, username, password, service), service);&#x20;

&#x20;   }&#x20;

&#x20;   private static void warning(String msg) {&#x20;

&#x20;       System.out.println(msg);&#x20;

&#x20;   }&#x20;

&#x20;   private static void info(String msg) {&#x20;

&#x20;       System.out.println(msg);&#x20;

&#x20;   }&#x20;

}
```

> （注：文档部分内容可能由 AI 生成）